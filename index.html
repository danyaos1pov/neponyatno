<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ON1X VPN</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root{
            --primary-color:#2481cc;--bg-dark:#0d1117;--card-bg:#161b22;--text-color:#e6edf3;
            --text-secondary:#b0b8c2;--border-color:rgba(255,255,255,.05);
            --nav-bg-opacity:rgba(10,14,19,.7); /* 70% непрозрачность */
            --nav-border:rgba(255,255,255,.1);
            --nav-active:rgba(36,129,204,.25);--hover-bg:rgba(255,255,255,.05);
            --reload-bg:#161b22;--reload-text:#b0b8c2;--reload-border:rgba(255,255,255,.05);
            --reload-hover-bg:rgba(255,255,255,.05);--reload-hover-text:#e6edf3;
        }
        [data-theme="light"]{
            --primary-color:#0077cc;--bg-dark:#f8f9fa;--card-bg:#ffffff;--text-color:#1a1a1a;
            --text-secondary:#555555;--border-color:#e0e0e0;
            --nav-bg-opacity:rgba(255,255,255,.7); /* 70% для светлой */
            --nav-border:rgba(0,0,0,.1);
            --nav-active:rgba(0,119,204,.15);--hover-bg:rgba(0,0,0,.05);
            --reload-bg:#ffffff;--reload-text:#555555;--reload-border:#e0e0e0;
            --reload-hover-bg:rgba(0,0,0,.05);--reload-hover-text:#1a1a1a;
        }
        *{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;}
        body{background:var(--bg-dark);color:var(--text-color);min-height:100vh;overflow-x:hidden;padding-bottom:90px;transition:all .3s;}
        a{color:inherit;text-decoration:none;}
        .page{display:none;opacity:0;transition:opacity .2s;}
        .page.active{display:block;opacity:1;}
        .main-content{padding:20px 15px;max-width:600px;margin:0 auto;}
        .header{margin:20px auto 8px;text-align:center;position:relative;}
        .header h1{font-size:2.5em;color:var(--primary-color);margin:0;line-height:1.1;}
        .header h1 span{color:var(--text-color);}
        .header .tagline{font-size:1.05em;color:var(--text-secondary);margin-top:4px;font-weight:500;}
        .settings-icon{position:absolute;right:0;top:50%;transform:translateY(-50%);width:36px;height:36px;
            background:var(--card-bg);border:1px solid var(--border-color);border-radius:50%;display:flex;
            align-items:center;justify-content:center;cursor:pointer;font-size:1.1em;color:var(--primary-color);
            box-shadow:0 2px 8px rgba(0,0,0,.1);transition:.2s;}
        .settings-icon:hover{background:var(--hover-bg);transform:translateY(-50%) scale(1.1);}
        .user-profile{display:flex;align-items:center;gap:12px;margin:10px auto 20px;max-width:500px;
            padding:15px;background:var(--card-bg);border-radius:15px;box-shadow:0 4px 10px rgba(0,0,0,.15);
            border:1px solid var(--border-color);}
        .user-avatar{width:40px;height:40px;border-radius:50%;object-fit:cover;}
        .user-greeting{font-size:1.1em;font-weight:600;color:var(--text-color);margin-bottom:3px;}
        .user-id{font-size:.85em;color:var(--text-secondary);}
        .subscription-block{background:var(--card-bg);border-radius:18px;padding:20px 18px;
            box-shadow:0 6px 16px rgba(0,0,0,.15);border:1px solid var(--border-color);margin-bottom:16px;}
        .block-title{font-size:1.1em;font-weight:600;color:var(--text-color);margin-bottom:14px;text-align:center;}
        .action-buttons-row{display:flex;gap:8px;margin-bottom:12px;}
        .tg-button{flex:1;display:flex;align-items:center;justify-content:center;gap:8px;padding:13px 0;
            background:var(--primary-color);color:#fff;font-weight:500;font-size:1em;border-radius:8px;
            cursor:pointer;transition:.2s;}
        .tg-button:hover{background:#0066aa;}
        .tg-button.single-button{margin-top:12px;}
        .profile-menu{display:flex;flex-direction:column;gap:8px;}
        .profile-menu-btn{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--card-bg);
            color:var(--text-color);font-size:1em;border-radius:12px;cursor:pointer;transition:.2s;
            border:1px solid var(--border-color);}
        .profile-menu-btn i{font-size:1.2em;color:var(--primary-color);width:24px;text-align:center;}
        .profile-menu-btn .btn-text{flex:1;text-align:center;margin-left:-18px;}
        .profile-menu-btn:hover{background:var(--hover-bg);}
        .reload-btn{
            background:var(--reload-bg);color:var(--reload-text);border:1px solid var(--reload-border);
            padding:10px 20px;border-radius:12px;font-size:.9em;font-weight:500;cursor:pointer;
            width:180px;margin:20px auto 0;transition:.2s;display:flex;align-items:center;justify-content:center;gap:8px;
        }
        .reload-btn:hover{background:var(--reload-hover-bg);color:var(--reload-hover-text);}
        .reload-btn.full{width:100%;margin:16px 0 0;}
        .balance-card{background:var(--card-bg);border-radius:18px;padding:18px;margin:20px 0;
            box-shadow:0 6px 16px rgba(0,0,0,.15);border:1px solid var(--border-color);text-align:center;}
        .balance-label{font-size:.9em;color:var(--text-secondary);margin-bottom:6px;}
        .balance-value{font-size:1.8em;font-weight:700;color:var(--text-color);margin-bottom:16px;}
        .balance-actions{display:flex;gap:10px;}
        .balance-btn{flex:1;padding:12px 0;background:var(--primary-color);color:#fff;font-weight:500;
            font-size:.95em;border-radius:8px;cursor:pointer;transition:.2s;display:flex;align-items:center;
            justify-content:center;gap:8px;}
        .balance-btn:hover{background:#0066aa;}
        .app-version{margin-top:30px;font-size:.8em;color:var(--text-secondary);text-align:center;}

        /* НИЖНЕЕ МЕНЮ — ВИДНОЕ, НО ПРОЗРАЧНОЕ С РАЗМЫТИЕМ */
        .bottom-nav{
            position:fixed;bottom:16px;left:25px;right:25px;
            background:var(--nav-bg-opacity);
            border:1px solid var(--nav-border);
            border-radius:20px;overflow:hidden;display:flex;
            padding:8px 12px;gap:8px;z-index:1000;
            backdrop-filter:blur(16px);
            -webkit-backdrop-filter:blur(16px);
            height:72px;
        }
        .nav-item{
            flex:1;padding:10px 0;color:var(--text-secondary);font-size:.8em;font-weight:600;text-align:center;
            border-radius:12px;cursor:pointer;transition:.25s;display:flex;flex-direction:column;
            align-items:center;gap:4px;
        }
        .nav-item i{font-size:1.35em;transition:transform .2s;}
        .nav-item.active{color:var(--primary-color);background:var(--nav-active);font-weight:700;}
        .nav-item.active i{transform:scale(1.15);}
        .nav-item:hover:not(.active){background:var(--hover-bg);}

        .settings-block{background:var(--card-bg);border-radius:18px;padding:20px;margin:20px 0;
            box-shadow:0 6px 16px rgba(0,0,0,.15);border:1px solid var(--border-color);}
        .setting-item{display:flex;align-items:center;justify-content:space-between;padding:14px 0;
            border-bottom:1px solid var(--border-color);font-size:1em;}
        .setting-item:last-child{border-bottom:none;}
        .setting-label{font-weight:500;color:var(--text-color);}
        .toggle-switch{position:relative;width:48px;height:26px;background:#ccc;border-radius:50px;cursor:pointer;}
        .toggle-switch input{opacity:0;width:0;height:0;}
        .slider{position:absolute;top:0;left:0;right:0;bottom:0;background:#ccc;border-radius:50px;transition:.3s;}
        .slider:before{position:absolute;content:"";height:20px;width:20px;left:3px;bottom:3px;
            background:#fff;border-radius:50%;transition:.3s;box-shadow:0 1px 3px rgba(0,0,0,.3);}
        input:checked+.slider{background:var(--primary-color);}
        input:checked+.slider:before{transform:translateX(22px);}
        .faq-accordion{background:var(--card-bg);border-radius:18px;margin:20px 0;
            box-shadow:0 6px 16px rgba(0,0,0,.15);border:1px solid var(--border-color);overflow:hidden;}
        .faq-item{border-bottom:1px solid var(--border-color);}
        .faq-item:last-child{border-bottom:none;}
        .faq-question{padding:16px 18px;background:transparent;color:var(--text-color);font-weight:600;
            font-size:1em;cursor:pointer;display:flex;justify-content:space-between;align-items:center;
            transition:.2s;user-select:none;}
        .faq-question:hover{background:var(--hover-bg);}
        .faq-question i{color:var(--text-secondary);transition:transform .3s;font-size:.9em;}
        .faq-question.active i{transform:rotate(180deg);color:var(--primary-color);}
        .faq-answer{max-height:0;overflow:hidden;padding:0 18px;color:var(--text-secondary);
            font-size:.95em;line-height:1.6;transition:max-height .3s,padding .3s;}
        .faq-answer.open{max-height:500px;padding:16px 18px;}
        .tariff-selection-block,.duration-block{background:var(--card-bg);border-radius:18px;
            padding:18px;margin:20px 0;box-shadow:0 6px 16px rgba(0,0,0,.15);border:1px solid var(--border-color);}
        .tariff-title,.duration-title{text-align:center;font-size:1.1em;font-weight:600;
            color:var(--text-color);margin-bottom:16px;}

        /* ТАРИФЫ — ЕДИНЫЙ БЛОК БЕЗ РАЗДЕЛИТЕЛЕЙ */
        .tariff-buttons{
            display:flex;
            margin-bottom:16px;
            border-radius:12px;
            overflow:hidden;
            border:2px solid var(--border-color);
        }
        .tariff-btn{
            flex:1;
            padding:14px 0;
            background:var(--card-bg);
            border:none !important;
            font-size:1em;
            font-weight:600;
            color:var(--text-color);
            text-align:center;
            cursor:pointer;
            transition:background .2s;
        }
        .tariff-btn:hover{
            background:var(--hover-bg);
        }
        .tariff-btn.selected{
            background:var(--nav-active);
            color:var(--primary-color);
            font-weight:700;
        }

        .tariff-features-row{display:flex;justify-content:space-around;gap:12px;font-size:.9em;
            color:var(--text-secondary);padding:12px 0;border-top:1px solid var(--border-color);}
        .feature-item{display:flex;flex-direction:column;align-items:center;gap:6px;flex:1;}
        .feature-item i{color:var(--primary-color);font-size:1.3em;}
        .feature-item span{font-size:.85em;text-align:center;}
        .duration-options{display:flex;flex-direction:column;gap:10px;margin-bottom:20px;}
        .duration-option{background:var(--card-bg);border:2px solid var(--border-color);
            border-radius:12px;padding:14px 16px;display:flex;justify-content:space-between;
            align-items:center;cursor:pointer;transition:.2s;font-size:1em;font-weight:500;}
        .duration-option:hover{background:var(--hover-bg);border-color:var(--text-secondary);}
        .duration-option.selected{border-color:var(--primary-color);background:var(--nav-active);
            color:var(--primary-color);font-weight:700;}
        .duration-option .price{color:#fff !important; font-weight:700;}
        .buy-full-button{width:100%;padding:16px 0;background:var(--primary-color);color:#fff;
            font-weight:600;font-size:1.1em;border-radius:12px;cursor:pointer;transition:.2s;
            display:flex;align-items:center;justify-content:center;gap:8px;}
        .buy-full-button.disabled{background:#555;opacity:.6;pointer-events:none;}
        .buy-full-button:not(.disabled):hover{background:#0066aa;}
        .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);
            z-index:2000;display:flex;align-items:center;justify-content:center;opacity:0;
            pointer-events:none;transition:opacity .3s;}
        .modal-overlay.active{opacity:1;pointer-events:auto;}
        .modal{background:var(--card-bg);border-radius:18px;padding:24px;max-width:90%;width:380px;
            text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.3);border:1px solid var(--border-color);}
        .modal h3{font-size:1.2em;margin-bottom:12px;color:var(--text-color);}
        .modal p{font-size:.95em;color:var(--text-secondary);line-height:1.5;margin-bottom:20px;}
        .modal .close-btn{background:var(--primary-color);color:#fff;border:none;padding:12px 24px;
            border-radius:12px;font-weight:600;cursor:pointer;}
        .modal .close-btn:hover{background:#0066aa;}

        .news-block{
            background:var(--card-bg);border-radius:18px;padding:20px 18px;
            box-shadow:0 6px 16px rgba(0,0,0,.15);border:1px solid var(--border-color);
            margin-bottom:16px;text-align:center;
        }
        .news-text{
            font-size:1em;color:var(--text-color);margin-bottom:14px;line-height:1.5;
        }
        .subscribe-btn{
            display:inline-flex;align-items:center;justify-content:center;gap:8px;
            padding:13px 0;background:var(--primary-color);color:#fff;font-weight:500;
            font-size:1em;border-radius:8px;cursor:pointer;transition:.2s;width:100%;
        }
        .subscribe-btn:hover{background:#0066aa;}
    </style>
</head>
<body data-theme="dark">

    <!-- СТРАНИЦА ПОДПИСКИ -->
    <div id="subscription-page" class="page active">
        <div class="main-content">
            <div class="header">
                <h1><span>ON1X</span> VPN</h1>
                <div class="tagline">Свобода. Безопасность. Надежность.</div>
                <div class="settings-icon" onclick="showPage('settings-page')">
                    <i class="fas fa-cog"></i>
                </div>
            </div>

            <div class="user-profile">
                <img id="user-avatar-sub" class="user-avatar" src="" alt="Аватар">
                <div>
                    <div id="user-greeting-sub" class="user-greeting">Добро пожаловать, </div>
                    <div id="user-id-sub" class="user-id"></div>
                </div>
            </div>

            <!-- БЛОК: Подписка ON1X VPN -->
            <div class="subscription-block">
                <div class="block-title">Подписка ON1X VPN</div>
                <div class="action-buttons-row">
                    <div class="tg-button" onclick="showPage('buy-page')">
                        <i class="fas fa-shopping-cart"></i> Купить
                    </div>
                    <div class="tg-button" onclick="showPage('extend-page')">
                        <i class="fas fa-clock"></i> Продлить
                    </div>
                </div>
                <div class="tg-button single-button" onclick="goToLinkAndClose('https://t.me/on1xVPN_bot?start=c_2293355')">
                    <i class="fas fa-gift"></i> Тестовый период
                </div>
            </div>

            <!-- БЛОК: Управление подпиской -->
            <div class="subscription-block">
                <div class="block-title">Управление подпиской</div>
                <div class="profile-menu">
                    <div class="profile-menu-btn" onclick="goToLinkAndClose('https://t.me/on1xVPN_bot?start=f_5331349')">
                        <i class="fas fa-key"></i>
                        <div class="btn-text">Моя подписка</div>
                    </div>
                    <div class="profile-menu-btn" onclick="showChangeTariffModal()">
                        <i class="fas fa-exchange-alt"></i>
                        <div class="btn-text">Сменить тариф</div>
                    </div>
                    <div class="profile-menu-btn" onclick="goToLinkAndClose('https://t.me/on1xVPN_bot?start=f_5098822')">
                        <i class="fas fa-undo"></i>
                        <div class="btn-text">Возврат подписки</div>
                    </div>
                </div>
            </div>

            <!-- НОВЫЙ БЛОК: Подписка на новости -->
            <div class="news-block">
                <div class="news-text">Следите за новостями, обновлениями и розыгрышами</div>
                <div class="subscribe-btn" onclick="goToLinkAndClose('https://t.me/ON1Xvpn')">
                    <i class="fab fa-telegram-plane"></i> Подписаться в Telegram
                </div>
            </div>

            <button class="reload-btn" onclick="reloadApp()">
                <i class="fas fa-sync-alt"></i> Перезагрузить
            </button>

            <div class="app-version">Версия: 1.0.0</div>
        </div>
    </div>

    <!-- ПРОФИЛЬ (ТОЛЬКО БАЛАНС) -->
    <div id="profile-page" class="page">
        <div class="main-content">
            <div class="header">
                <h1><span>ON1X</span> VPN</h1>
                <div class="tagline">Свобода. Безопасность. Надежность.</div>
            </div>

            <div class="user-profile">
                <img id="user-avatar-prof" class="user-avatar" src="" alt="Аватар">
                <div>
                    <div id="user-greeting-prof" class="user-greeting">Добро пожаловать, </div>
                    <div id="user-id-prof" class="user-id"></div>
                </div>
            </div>

            <div class="balance-card">
                <div class="balance-label">Ваш баланс</div>
                <div id="balance-value" class="balance-value">0 RUB</div>
                <div class="balance-actions">
                    <div class="balance-btn" onclick="goToLinkAndClose('https://t.me/on1xVPN_bot?start=f_3781780')">
                        <i class="fas fa-arrow-up"></i> Вывести
                    </div>
                    <div class="balance-btn" onclick="goToLinkAndClose('https://t.me/on1xVPN_bot?start=f_5494846')">
                        <i class="fas fa-plus"></i> Пополнить
                    </div>
                </div>
            </div>

            <div class="app-version">Версия: 1.0.0</div>
        </div>
    </div>

    <!-- МЕНЮ -->
    <div id="menu-page" class="page">
        <div class="main-content">
            <div class="header">
                <h1><span>ON1X</span> VPN</h1>
                <div class="tagline">Свобода. Безопасность. Надежность.</div>
            </div>

            <div class="user-profile">
                <img id="user-avatar-menu" class="user-avatar" src="" alt="Аватар">
                <div>
                    <div id="user-greeting-menu" class="user-greeting">Добро пожаловать, </div>
                    <div id="user-id-menu" class="user-id"></div>
                </div>
            </div>

            <div class="profile-menu">
                <div class="profile-menu-btn">
                    <i class="fas fa-download"></i>
                    <div class="btn-text">Установить приложение</div>
                </div>
                <div class="profile-menu-btn" onclick="goToLinkAndClose('https://t.me/on1xVPN_bot?start=f_5371698')">
                    <i class="fas fa-user-plus"></i>
                    <div class="btn-text">Пригласить друзей</div>
                </div>
                <div class="profile-menu-btn" onclick="showPage('faq-page', 'menu-page')">
                    <i class="fas fa-question-circle"></i>
                    <div class="btn-text">FAQ</div>
                </div>
                <div class="profile-menu-btn" onclick="goToLinkAndClose('https://t.me/on1xVPN_admin')">
                    <i class="fas fa-headset"></i>
                    <div class="btn-text">Поддержка</div>
                </div>
                <div class="profile-menu-btn">
                    <i class="fas fa-server"></i>
                    <div class="btn-text">Статус систем</div>
                </div>
                <div class="profile-menu-btn" onclick="showPage('settings-page', 'menu-page')">
                    <i class="fas fa-cog"></i>
                    <div class="btn-text">Настройки приложения</div>
                </div>
            </div>

            <div class="app-version">Версия: 1.0.0</div>
        </div>
    </div>

    <!-- НАСТРОЙКИ -->
    <div id="settings-page" class="page">
        <div class="main-content">
            <div class="header">
                <h1><span>ON1X</span> VPN</h1>
                <div class="tagline">Настройки приложения</div>
            </div>

            <div class="settings-block">
                <div class="setting-item">
                    <div class="setting-label">Светлая тема</div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="theme-toggle">
                        <span class="slider"></span>
                    </label>
                </div>

                <button class="reload-btn full" onclick="reloadApp()">
                    <i class="fas fa-sync-alt"></i> Перезагрузить приложение
                </button>
            </div>

            <div class="app-version">Версия: 1.0.0</div>
        </div>
    </div>

    <!-- FAQ -->
    <div id="faq-page" class="page">
        <div class="main-content">
            <div class="header">
                <h1><span>ON1X</span> VPN</h1>
                <div class="tagline">Часто задаваемые вопросы</div>
            </div>

            <div class="faq-accordion">
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        Как подключиться? <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        Для того, чтобы подключиться, вам необходимо в разделе "Подписка" нажать кнопку "Купить", а затем выбрать необходимый тариф.
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        Лимит устройств <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        Каждый тариф ограничивается определенным количеством устройств на одном ключе:<br>
                        <strong>Личный</strong> — 3 устройства<br>
                        <strong>Семейный</strong> — 6 устройств<br>
                        <strong>Навсегда</strong> — от 3 до 6 устройств
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        Как поменять тариф? <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        Для того, чтобы поменять тариф, вам необходимо в разделе "Подписка" нажать кнопку "Сменить тариф".
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        Как вывести деньги с кошелька? <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        Для того, чтобы вывести денежные средства на банковскую карту или криптокошелек, вам необходимо перейти в раздел "Профиль" и под балансом нажать кнопку "Вывести".
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        Как вернуть подписку? <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        Для того, чтобы оформить возврат подписки, вам необходимо перейти в раздел "Профиль", а затем выбрать "Возврат подписки".
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        Какой бонус за друга? <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        После того, как ваш друг перешел по вашей реферальной ссылке, то вы будете получать каждый раз <strong>15%</strong>, когда друг будет приобретать/продлевать подписку.
                    </div>
                </div>
            </div>

            <div class="app-version">Версия: 1.0.0</div>
        </div>
    </div>

    <!-- СТРАНИЦА КУПИТЬ ПОДПИСКУ -->
    <div id="buy-page" class="page">
        <div class="main-content">
            <div class="header">
                <h1><span>ON1X</span> VPN</h1>
                <div class="tagline">Купить подписку</div>
            </div>

            <div class="tariff-selection-block">
                <div class="tariff-title">Выберите тариф</div>
                <div class="tariff-buttons">
                    <div class="tariff-btn selected" data-tariff="personal" onclick="selectTariff(this,'buy-page')">Личный</div>
                    <div class="tariff-btn" data-tariff="family" onclick="selectTariff(this,'buy-page')">Семейный</div>
                    <div class="tariff-btn" data-tariff="forever" onclick="selectTariff(this,'buy-page')">Навсегда</div>
                </div>
                <div id="tariff-features-buy" class="tariff-features-row"></div>
            </div>

            <div class="duration-block">
                <div class="duration-title">Выберите срок подписки</div>
                <div id="duration-options-buy" class="duration-options"></div>
                <div id="buy-full-button-buy" class="buy-full-button disabled">
                    <i class="fas fa-shopping-cart"></i> Выберите тариф
                </div>
            </div>

            <div class="app-version">Версия: 1.0.0</div>
        </div>
    </div>

    <!-- СТРАНИЦА ПРОДЛИТЬ ПОДПИСКУ -->
    <div id="extend-page" class="page">
        <div class="main-content">
            <div class="header">
                <h1><span>ON1X</span> VPN</h1>
                <div class="tagline">Продлить подписку</div>
            </div>

            <div class="tariff-selection-block">
                <div class="tariff-title">Выберите тариф</div>
                <div class="tariff-buttons">
                    <div class="tariff-btn selected" data-tariff="personal" onclick="selectTariff(this,'extend-page')">Личный</div>
                    <div class="tariff-btn" data-tariff="family" onclick="selectTariff(this,'extend-page')">Семейный</div>
                    <div class="tariff-btn" data-tariff="forever" onclick="selectTariff(this,'extend-page')">Навсегда</div>
                </div>
                <div id="tariff-features-extend" class="tariff-features-row"></div>
            </div>

            <div class="duration-block">
                <div class="duration-title">Выберите срок продления</div>
                <div id="duration-options-extend" class="duration-options"></div>
                <div id="buy-full-button-extend" class="buy-full-button disabled">
                    <i class="fas fa-clock"></i> Выберите тариф
                </div>
            </div>

            <div class="app-version">Версия: 1.0.0</div>
        </div>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО -->
    <div id="change-tariff-modal" class="modal-overlay">
        <div class="modal">
            <h3>Смена тарифа</h3>
            <p>Для того, чтобы сменить тариф, при продлении подписки необходимо выбрать другой тариф.</p>
            <button class="close-btn" onclick="closeModal()">Понятно</button>
        </div>
    </div>

    <!-- НИЖНЕЕ МЕНЮ -->
    <div class="bottom-nav">
        <div class="nav-item active" data-page="subscription-page">
            <i class="fas fa-key"></i>
            <div>Подписка</div>
        </div>
        <div class="nav-item" data-page="profile-page">
            <i class="fas fa-wallet"></i>
            <div>Профиль</div>
        </div>
        <div class="nav-item" data-page="menu-page">
            <i class="fas fa-bars"></i>
            <div>Меню</div>
        </div>
    </div>

    <script>
        // ТЕМА
        const themeToggle = document.getElementById('theme-toggle'), body = document.body;
        function applyTheme(t) {
            body.setAttribute('data-theme', t);
            themeToggle.checked = t === 'light';
            localStorage.setItem('on1x-theme', t);
        }
        applyTheme(localStorage.getItem('on1x-theme') || 'dark');
        themeToggle.addEventListener('change', () => applyTheme(themeToggle.checked ? 'light' : 'dark'));

        // ПЕРЕЗАГРУЗКА
        function reloadApp() {
            Telegram?.WebApp?.restart ? Telegram.WebApp.restart() : location.reload();
        }

        // НАВИГАЦИЯ
        let lastMainPage = 'subscription-page';
        function showPage(id, from = null) {
            if (from) lastMainPage = from;
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.dataset.page === id));

            if (Telegram?.WebApp?.BackButton) {
                const mainPages = ['subscription-page', 'profile-page', 'menu-page'];
                if (mainPages.includes(id)) {
                    Telegram.WebApp.BackButton.hide();
                } else {
                    Telegram.WebApp.BackButton.show();
                    Telegram.WebApp.BackButton.onClick(() => showPage(lastMainPage));
                }
            }
            if (id === 'buy-page' || id === 'extend-page') initBuyPage(id);
        }
        document.querySelectorAll('.nav-item').forEach(i => i.addEventListener('click', () => {
            lastMainPage = i.dataset.page;
            showPage(i.dataset.page);
        }));

        // ПЕРЕХОД
        function goToLinkAndClose(url) {
            window.location.href = url;
            setTimeout(() => { Telegram?.WebApp?.close && Telegram.WebApp.close(); }, 300);
        }

        // МОДАЛЬ
        function showChangeTariffModal() { document.getElementById('change-tariff-modal').classList.add('active'); }
        function closeModal() { document.getElementById('change-tariff-modal').classList.remove('active'); }

        // FAQ
        function toggleFaq(el) {
            const ans = el.nextElementSibling, open = ans.classList.contains('open');
            document.querySelectorAll('.faq-answer').forEach(a => a.classList.remove('open'));
            document.querySelectorAll('.faq-question').forEach(q => q.classList.remove('active'));
            if (!open) { ans.classList.add('open'); el.classList.add('active'); }
        }

        // ТАРИФЫ
        const tariffData = {
            personal: { devices: 3, speed: 'Скорость до 10 Гбит/с', traffic: 'Безлимит трафик', icon: 'fa-user' },
            family: { devices: 6, speed: 'Скорость до 10 Гбит/с', traffic: 'Безлимит трафик', icon: 'fa-users' },
            forever: { devices: 'от 3 до 6', speed: 'Скорость до 25 Гбит/с', traffic: 'Безлимит трафик', icon: 'fa-users-cog' }
        };
        const tariffPrices = {
            personal: [{ days: 30, price: 100 }, { days: 60, price: 200 }, { days: 90, price: 300 }, { days: 180, price: 600 }],
            family: [{ days: 30, price: 200 }, { days: 60, price: 400 }, { days: 90, price: 600 }, { days: 180, price: 1200 }],
            forever: [{ devices: 3, price: 4000 }, { devices: 4, price: 4500 }, { devices: 5, price: 5000 }, { devices: 6, price: 5500 }]
        };
        const selection = { 'buy-page': { tariff: null, duration: null }, 'extend-page': { tariff: null, duration: null } };

        function initBuyPage(pageId) {
            selection[pageId] = { tariff: null, duration: null };
            const def = document.querySelector(`#${pageId} .tariff-btn[data-tariff="personal"]`);
            def && selectTariff(def, pageId);
        }

        function selectTariff(btn, pageId) {
            const isBuy = pageId === 'buy-page', prefix = isBuy ? 'buy' : 'extend';
            document.querySelectorAll(`#${pageId} .tariff-btn`).forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            const t = btn.dataset.tariff; selection[pageId].tariff = t; selection[pageId].duration = null;
            const f = tariffData[t], fe = document.getElementById(`tariff-features-${prefix}`);

            const devicesText = t === 'forever' ? f.devices : `${f.devices} устройства`;

            fe.innerHTML = `
                <div class="feature-item"><i class="fas ${f.icon}"></i><span>${devicesText}</span></div>
                <div class="feature-item"><i class="fas fa-tachometer-alt"></i><span>${f.speed}</span></div>
                <div class="feature-item"><i class="fas fa-infinity"></i><span>${f.traffic}</span></div>`;
            
            const oc = document.getElementById(`duration-options-${prefix}`); oc.innerHTML = '';
            const forever = t === 'forever';
            document.querySelector(`#${pageId} .duration-title`).textContent = forever ?
                (isBuy ? 'Выберите кол-во устройств' : 'Выберите кол-во устройств') :
                (isBuy ? 'Выберите срок подписки' : 'Выберите срок продления');
            tariffPrices[t].forEach(it => {
                const opt = document.createElement('div'); opt.className = 'duration-option';
                const label = forever ? `${it.devices} устройства` : `${it.days} дней`;
                const val = forever ? it.devices : it.days;
                opt.innerHTML = `<span>${label}</span><span class="price">${it.price} ₽</span>`;
                opt.onclick = () => {
                    document.querySelectorAll(`#${pageId} .duration-option`).forEach(o => o.classList.remove('selected'));
                    opt.classList.add('selected');
                    selection[pageId].duration = { ...it, value: val };
                    updateBuyButton(pageId);
                };
                oc.appendChild(opt);
            });
            updateBuyButton(pageId);
        }

        function updateBuyButton(pageId) {
            const isBuy = pageId === 'buy-page', prefix = isBuy ? 'buy' : 'extend';
            const btn = document.getElementById(`buy-full-button-${prefix}`), sel = selection[pageId];
            if (sel.tariff && sel.duration) {
                btn.classList.remove('disabled');
                const suf = sel.tariff === 'forever' ? sel.duration.value : sel.duration.days;
                const cmd = isBuy ? 'buy' : 'extend', act = isBuy ? 'Купить' : 'Продлить';
                btn.innerHTML = `<i class="fas fa-${isBuy ? 'shopping-cart' : 'clock'}"></i> ${act} за ${sel.duration.price} ₽`;
                btn.onclick = () => goToLinkAndClose(`https://t.me/on1xVPN_bot?start=${cmd}_${sel.tariff}_${suf}`);
            } else {
                btn.classList.add('disabled'); btn.onclick = null;
                let ph = !sel.tariff ? 'Выберите тариф' : (sel.tariff === 'forever' ? 'Выберите кол-во устройств' :
                    (isBuy ? 'Выберите срок подписки' : 'Выберите срок продления'));
                btn.innerHTML = `<i class="fas fa-${isBuy ? 'shopping-cart' : 'clock'}"></i> ${ph}`;
            }
        }

        // ПОЛЬЗОВАТЕЛЬ + БАЛАНС — ФОРМАТ 250,6 RUB
        let loaded = false;
        function loadUserData() {
            if (loaded) return; loaded = true;
            if (!Telegram?.WebApp?.initDataUnsafe?.user) return;
            const u = Telegram.WebApp.initDataUnsafe.user;
            const uid = u.id, avatar = u.photo_url || 'https://sun9-8.userapi.com/s/v1/ig2/YBkIITuiQ13e1vw3WhNGJekU_fMB3jXEeTjqLb-EAnydjnDmqCVu7sATDepkrUUo6UXWQ4x74BtgfBrgdhWUZZlN.jpg?quality=95&as=32x32,48x48,72x72,108x108,160x160,240x240,360x360,480x480,540x540,640x640&from=bu&cs=640x0';
            const greet = `Добро пожаловать, ${u.first_name}${u.last_name ? ' ' + u.last_name : ''}`;
            ['sub', 'prof', 'menu'].forEach(s => {
                const el = document.getElementById(`user-avatar-${s}`);
                if (el) el.src = avatar;
                const g = document.getElementById(`user-greeting-${s}`);
                if (g) g.textContent = greet;
                const id = document.getElementById(`user-id-${s}`);
                if (id) id.textContent = `ID: ${uid}`;
            });

            const API_URL = 'https://script.google.com/macros/s/AKfycbw02X1b1uJXdqTY7u5IUCfmDjwuqLwd4tBkgbwq8DCZXlsnX5swXKlgarpwm1JsBSCV/exec';
            fetch(`${API_URL}?id=${uid}`)
                .then(r => r.ok ? r.json() : Promise.reject())
                .then(d => {
                    const bal = Number(d.balance || 0);
                    const formatted = bal % 1 === 0 ? bal.toFixed(0) : bal.toFixed(1).replace(/\.0$/, '');
                    document.getElementById('balance-value').textContent = `${formatted.replace('.', ',')} RUB`;
                })
                .catch(() => {
                    document.getElementById('balance-value').textContent = '0 RUB';
                });
        }

        document.addEventListener('DOMContentLoaded', () => {
            Telegram?.WebApp?.ready();
            Telegram?.WebApp?.disableVerticalSwipes?.();
            loadUserData();
        });
    </script>
</body>
</html>
