<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ON1X VPN MiniApp</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
/* === Глобальные стили === */
:root {
    --primary-color: #007bff; --secondary-color: #28a745; --bg-dark: #0d1117;
    --card-bg: #161b22; --text-color: #e6edf3; --accent-red: #dc3545;
}
* { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
body { background: var(--bg-dark); color: var(--text-color); text-align: center; min-height: 100vh; padding-bottom: 50px; }
a { text-decoration: none; color: inherit; }

/* === МОДАЛЬНОЕ ОКНО === */
#modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; z-index: 10002; opacity: 0; transition: opacity 0.3s ease; }
#modal-overlay.visible { display: flex; opacity: 1; }
#modal-popup { background: var(--card-bg); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 90%; max-width: 380px; text-align: center; transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.3,0.7,0.4,1.2); }
#modal-overlay.visible #modal-popup { transform: scale(1); }
#modal-popup i { font-size: 48px; color: var(--primary-color); margin-bottom: 15px; }
#modal-title { font-size: 1.5em; font-weight: 700; margin-bottom: 10px; }
#modal-message { font-size: 1em; color: #b0b8c2; line-height: 1.6; margin-bottom: 25px; }
#modal-close-button { background: var(--primary-color); color: white; border: none; border-radius: 10px; padding: 12px 0; width: 100%; font-size: 1em; font-weight: 600; cursor: pointer; transition: background 0.2s; }
#modal-close-button:hover { background: #0056b3; }

/* === SPLASH === */
#splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-dark); display: flex; justify-content: center; align-items: center; flex-direction: column; z-index: 1000; opacity: 1; transition: opacity 0.7s ease-out; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.spin { animation: spin 1s linear infinite; }
.pulse-container { position: relative; width: 120px; height: 120px; margin: 30px auto 10px; }
.pulse-container img { position: absolute; top:0; left:0; width:100%; height:100%; border-radius:50%; z-index:10; border:4px solid var(--primary-color); object-fit: cover; }
.pulse-circle { position: absolute; top:50%; left:50%; width:120px; height:120px; border-radius:50%; border: 2px solid rgba(0,123,255,0.5); transform: translate(-50%,-50%) scale(0); animation: pulse 2.5s infinite cubic-bezier(0.25, 0.46, 0.45, 0.94); }
.pulse-circle:nth-child(2) { animation-delay:0.5s; }
.pulse-circle:nth-child(3) { animation-delay:1s; }
@keyframes pulse { 0% { transform: translate(-50%,-50%) scale(0.8); opacity:1; } 100% { transform: translate(-50%,-50%) scale(1.5); opacity:0; } }

/* === СТРАНИЦЫ === */
.page { position: absolute; top: 0; left: 50%; width: 100%; max-width: 600px; padding: 20px 15px; transition: transform 0.4s cubic-bezier(0.2,0.8,0.4,1), opacity 0.4s; display: none; z-index: 10; transform: translate(-50%,0) scale(1); opacity: 1; }
@media (max-width: 600px) { #home, #subscription, #buy, #renew, #install, #status, #faq, #support, #ideas { padding-top: 15px; } }
.page.enter-forward { transform: translate(-50%,0) scale(0.9); opacity: 0; display: block; z-index: 20; }
.page.exit-forward { transform: translate(-50%,0) scale(0.95); opacity: 0; display: block; z-index: 10; }
.page.enter-backward { transform: translate(-50%,0) scale(0.95); opacity: 0; display: block; z-index: 10; }
.page.exit-backward { transform: translate(-50%,0) scale(1.1); opacity: 0; display: block; z-index: 20; }
.page.active { transform: translate(-50%,0) scale(1); opacity: 1; display: block; z-index: 15; }

/* === ТЕКСТ === */
h1 { font-size: 2.2em; margin-bottom: 5px; color: var(--primary-color); }
h2 { font-size: 1.8em; margin: 0 0 20px; border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
p { margin:10px 0; line-height:1.6; color: #b0b8c2; }

/* === КАРТОЧКИ === */
.subscription-status-card { display: flex; justify-content: space-between; align-items: center; padding: 15px; margin: 20px auto 10px; max-width: 500px; background: var(--card-bg); border-radius: 15px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05); }
.subscription-status-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.6); border-color: var(--primary-color); }
.status-icon { font-size: 28px; color: var(--primary-color); min-width: 40px; }
.status-info { flex-grow: 1; text-align: center; margin: 0 10px; }
.status-title { margin: 0; font-weight: 700; font-size: 1.1em; }
.status-subtitle { margin: 0; font-size: 0.75em; color: #b0b8c2; }
.status-arrow { font-size: 1.2em; color: #b0b8c2; }

/* === МЕНЮ === */
.menu-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width:500px; margin:10px auto 20px; }
.menu-card { background: var(--card-bg); padding: 15px 10px; border-radius:15px; display:flex; flex-direction:column; justify-content:center; align-items:center; cursor:pointer; transition: transform 0.2s, box-shadow 0.2s; font-weight:600; color: var(--text-color); box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05); min-height: 80px; font-size: 0.85em; }
.menu-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.6); border-color: var(--primary-color); }
.menu-card i { font-size: 24px; margin-bottom: 5px; color: var(--primary-color); }

/* === КНОПКИ === */
.button { display:block; width:100%; max-width:300px; margin:20px auto; padding:12px 0; border-radius: 8px; background: var(--primary-color); color: white; border: none; box-shadow: 0 2px 5px rgba(0,0,0,0.4); font-weight:700; transition: all 0.2s; cursor: pointer; text-align: center; }
.button:hover { background: #0056b3; }
.button.disabled { background: #343a40 !important; color: #b0b8c2 !important; cursor: not-allowed; opacity: 0.7; }

/* === ПРОФИЛЬ === */
.user-profile { display: flex; align-items: center; justify-content: flex-start; margin: 20px auto; max-width: 500px; padding: 15px; gap: 12px; background: var(--card-bg); border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05); }
.user-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
.user-greeting { font-size: 1.1em; font-weight: 600; text-align: left; margin-bottom: 3px; }
.user-id { font-size: 0.85em; color: #b0b8c2; text-align: left; }

/* === ВЕРСИЯ === */
.app-version { margin-top: 30px; font-size: 0.8em; color: #6c757d; text-align: center; }
</style>
</head>
<body>
<div id="app-container">

    <!-- SPLASH -->
    <div id="splash-screen">
        <div class="pulse-container">
            <div class="pulse-circle"></div>
            <div class="pulse-circle"></div>
            <div class="pulse-circle"></div>
            <img class="logo" src="https://sun9-8.userapi.com/s/v1/ig2/YBkIITuiQ13e1vw3WhNGJekU_fMB3jXEeTjqLb-EAnydjnDmqCVu7sATDepkrUUo6UXWQ4x74BtgfBrgdhWUZZlN.jpg?quality=95&as=32x32,48x48,72x72,108x108,160x160,240x240,360x360,480x480,540x540,640x640&from=bu&cs=640x0" alt="ON1X VPN">
        </div>
        <p class="launch-text" style="font-size: 1.2em; font-weight: 600; color: var(--text-color); margin-top: 30px;">Открываем приложение</p>
    </div>

    <!-- HOME -->
    <div id="home" class="page"> 
        <div class="user-profile">
            <img id="user-avatar" class="user-avatar" src="" alt="Аватар">
            <div>
                <div id="user-greeting" class="user-greeting">Добро пожаловать, </div>
                <div id="user-id" class="user-id"></div>
            </div>
        </div>
        
        <h1><span style="color: var(--text-color);">ON1X</span> VPN</h1>
        
        <div class="subscription-status-card" onclick="showPage('subscription')">
            <div class="status-icon"><i class="fas fa-credit-card"></i></div>
            <div class="status-info">
                <p class="status-title">Подписка ON1X VPN</p>
                <p class="status-subtitle">Покупка, продление и управление подпиской</p>
            </div>
            <div class="status-arrow"><i class="fas fa-chevron-right"></i></div>
        </div>
        
        <div class="menu-grid">
            <div class="menu-card" onclick="showPage('install')"><i class="fas fa-download"></i>Установить</div>
            <div class="menu-card" onclick="goToLinkAndClose('https://t.me/on1xVPN_bot?start=f_5371698')"><i class="fas fa-user-plus"></i>Пригласить</div>
            <div class="menu-card" onclick="showPage('status')"><i class="fas fa-shield-alt"></i>Статус</div>
            <div class="menu-card" onclick="showPage('support')"><i class="fas fa-headset"></i>Поддержка</div>
            <div class="menu-card" onclick="showPage('faq')"><i class="fas fa-lightbulb"></i>FAQ</div>
            <div class="menu-card" onclick="showPage('ideas')"><i class="fas fa-lightbulb"></i>Предложить идею</div>
        </div>
        
        <div class="channel-promo">
            <p>Следите за новостями, обновлениями и акциями</p>
            <a href="https://t.me/ON1Xvpn" target="_blank" class="button"><i class="fab fa-telegram-plane"></i> Подписаться канал</a>
            <a href="https://vk.com/on1xvpn" target="_blank" class="button" style="background: #4C75A3; margin-top: 10px;"><i class="fab fa-vk"></i> Подписаться ВКонтакте</a>
        </div>

        <div class="app-version">Версия приложения: 5.1.1</div>
    </div>

    <!-- IDEAS -->
    <div id="ideas" class="page">
        <h2>Предложить идею</h2>
        <p>Поделитесь своими мыслями — мы читаем каждое сообщение!</p>

        <div style="max-width: 500px; margin: 20px auto;">
            <textarea id="idea-text" placeholder="Напишите вашу идею, пожелание или отзыв..." 
                      style="width: 100%; height: 120px; padding: 15px; border-radius: 12px; 
                             border: 1px solid rgba(255,255,255,0.1); background: var(--card-bg); 
                             color: var(--text-color); font-size: 1em; resize: none; margin-bottom: 15px;"></textarea>
            
            <button class="button" onclick="sendIdea()">
                Отправить идею
            </button>
        </div>

        <div id="idea-status" style="margin-top: 15px; font-size: 0.9em; color: #b0b8c2; text-align: center;"></div>
    </div>

</div> 

<!-- MODAL -->
<div id="modal-overlay">
    <div id="modal-popup">
        <i class="fas fa-tools"></i>
        <h3 id="modal-title"></h3>
        <p id="modal-message"></p>
        <button id="modal-close-button">Понятно</button>
    </div>
</div>

<script>
// === НАВИГАЦИЯ ===
const parentMap = {
    'subscription': 'home', 'buy': 'subscription', 'renew': 'subscription',
    'install': 'home', 'status': 'home', 'faq': 'home', 'support': 'home', 'ideas': 'home'
};

function showPage(id) {
    const pages = document.querySelectorAll('.page');
    const nextPage = document.getElementById(id);
    let currentPage = document.querySelector('.page.active');
    const duration = 400;

    if (!nextPage || nextPage.classList.contains('active')) return; 
    window.scrollTo(0, 0);

    const currentPageId = currentPage ? currentPage.id : null;
    let isBack = false;
    if (currentPageId && (parentMap[currentPageId] === id || id === 'home')) isBack = true;

    pages.forEach(p => {
        p.classList.remove('active', 'enter-forward', 'enter-backward', 'exit-forward', 'exit-backward');
        if (p !== currentPage && p !== nextPage) p.style.display = 'none';
    });

    nextPage.style.display = 'block'; 
    nextPage.classList.add(isBack ? 'enter-backward' : 'enter-forward');
    
    if (currentPage) {
        currentPage.style.display = 'block';
        currentPage.classList.add(isBack ? 'exit-backward' : 'exit-forward');
        setTimeout(() => { currentPage.style.display = 'none'; }, duration);
    }
    
    setTimeout(() => { 
        nextPage.classList.add('active');
        nextPage.classList.remove('enter-forward', 'enter-backward');
    }, 10);

    if (typeof Telegram !== 'undefined' && Telegram.WebApp && Telegram.WebApp.BackButton) {
        Telegram.WebApp.BackButton[id === 'home' ? 'hide' : 'show']();
    }
}

function telegramBackButtonHandler() {
    const current = document.querySelector('.page.active');
    if (current) showPage(parentMap[current.id] || 'home');
}

// === ИНИЦИАЛИЗАЦИЯ ===
document.addEventListener('DOMContentLoaded', () => {
    const splash = document.getElementById('splash-screen');
    setTimeout(() => {
        splash.style.opacity = '0';
        setTimeout(() => {
            splash.style.display = 'none';
            document.getElementById('home').classList.add('active');
            document.getElementById('home').style.display = 'block';
        }, 700);
    }, 1500);

    if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
        Telegram.WebApp.ready();
        if (Telegram.WebApp.disableVerticalSwipes) Telegram.WebApp.disableVerticalSwipes();
        if (Telegram.WebApp.BackButton) {
            Telegram.WebApp.BackButton.onClick(telegramBackButtonHandler);
            Telegram.WebApp.BackButton.hide();
        }

        const user = Telegram.WebApp.initDataUnsafe?.user;
        if (user) {
            const avatar = document.getElementById('user-avatar');
            avatar.src = user.photo_url || 'https://sun9-8.userapi.com/s/v1/ig2/YBkIITuiQ13e1vw3WhNGJekU_fMB3jXEeTjqLb-EAnydjnDmqCVu7sATDepkrUUo6UXWQ4x74BtgfBrgdhWUZZlN.jpg?quality=95&as=32x32,48x48,72x72,108x108,160x160,240x240,360x360,480x480,540x540,640x640&from=bu&cs=640x0';
            const name = [user.first_name, user.last_name].filter(Boolean).join(' ') || 'Пользователь';
            document.getElementById('user-greeting').textContent = 'Добро пожаловать, ' + name;
            document.getElementById('user-id').textContent = 'ID: ' + user.id;
        }
    }
});

// === ОТПРАВКА ИДЕИ (ОБНОВЛЕНО) ===
function sendIdea() {
    const text = document.getElementById('idea-text').value.trim();
    const statusEl = document.getElementById('idea-status');

    if (!text) {
        statusEl.innerHTML = '<span style="color: var(--accent-red);">Напишите что-нибудь</span>';
        return;
    }
    if (text.length > 1500) {
        statusEl.innerHTML = '<span style="color: var(--accent-red);">Макс. 1500 символов</span>';
        return;
    }

    let userInfo = 'Аноним';
    if (typeof Telegram !== 'undefined' && Telegram.WebApp && Telegram.WebApp.initDataUnsafe?.user) {
        const u = Telegram.WebApp.initDataUnsafe.user;
        const name = [u.first_name, u.last_name].filter(Boolean).join(' ') || 'Без имени';
        const username = u.username ? `@${u.username}` : '';
        userInfo = `${name} ${username} (ID: ${u.id})`.trim();
    }

    const fullMessage = `Новая идея\n\nОт: ${userInfo}\n\n${text}`;
    const encoded = encodeURIComponent(fullMessage);
    
    // ← НОВАЯ ССЫЛКА →
    const botUsername = 'statusON1X_bot';
    const url = `https://t.me/${botUsername}?start=feedback_${encoded}`;

    statusEl.innerHTML = '<span style="color: var(--secondary-color);"><i class="fas fa-spinner spin"></i> Отправка...</span>';
    window.location.href = url;

    setTimeout(() => {
        if (typeof Telegram !== 'undefined' && Telegram.WebApp && Telegram.WebApp.close) {
            Telegram.WebApp.close();
        }
    }, 800);
}

function goToLinkAndClose(url) {
    window.location.href = url;
    setTimeout(() => {
        if (typeof Telegram !== 'undefined' && Telegram.WebApp && Telegram.WebApp.close) {
            Telegram.WebApp.close();
        }
    }, 300);
}
</script>
</body>
</html>
